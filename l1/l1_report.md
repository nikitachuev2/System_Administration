# Отчет  
## По работе от 08.09.2025  

**Студент:** Чуев Никита  
**Группа:** p4250  
**Дата выполнения:** 08.09.2025  
**Дисциплина:** Системное администрирование  

---

# Задание 1. Настройка SSH  

## Цель  
Обеспечить защиту SSH-сервера за счет изменения порта, отключения root-доступа, запрета входа по паролю и использования только ключей.  

## Изменение конфигурации  

Редактирование выполнялось командой:  

```bash
sudo nano /etc/ssh/sshd_config
```

Были изменены параметры:  

```ini
Port 22222
PermitRootLogin no
PasswordAuthentication no
```

### Результат  
После этих изменений SSH стал доступен на порту **22222**. Root-пользователь больше не может подключаться напрямую. Парольная аутентификация отключена.  

## Создание нового пользователя  

```bash
sudo adduser nikitachuev
sudo usermod -aG sudo nikitachuev
```

Пользователь **nikitachuev** был добавлен в группу sudo и получил административные права.  

## Перезапуск службы  

```bash
sudo systemctl restart ssh
```

SSH был перезапущен и применил новые настройки.  

## Настройка ключей  

Ключи были сгенерированы в Windows при помощи **PuTTYgen**.  
Публичная часть была добавлена в систему:  

```bash
mkdir -p /home/nikitachuev/.ssh
echo "ПУБЛИЧНЫЙ_SSH_КЛЮЧ" >> /home/nikitachuev/.ssh/authorized_keys
chown -R nikitachuev:nikitachuev /home/nikitachuev/.ssh
chmod 700 /home/nikitachuev/.ssh
chmod 600 /home/nikitachuev/.ssh/authorized_keys
```

Подключение выполнялось к адресу **192.168.0.108** на порту **22222**.  
Вход под пользователем **nikitachuev** завершился успешно.  

---

# Задание 2. Настройка iptables  

## Цель  
Разрешить только нужные соединения и заблокировать все остальные.  

## Использованные команды  

```bash
sudo iptables -A INPUT -i lo -j ACCEPT
sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22222 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -j DROP
```

### Пояснение  
Loopback оставлен доступным, установленные соединения разрешены, открыт SSH-порт 22222 и HTTP-порт 80, остальной трафик блокируется.  

## Проверка через nmap  

После перезагрузки был выполнен скан:  

```bash
nmap -sT localhost
```

### Результат  
Система показала, что доступны только необходимые порты.  

---

# Задание 3. Fail2ban  

## Цель  
Заблокировать IP-адрес при множественных неудачных попытках входа.  

## Установка  

```bash
sudo apt install fail2ban -y
```

## Результат  
При трех–пяти неверных попытках входа IP автоматически блокируется. Это снижает вероятность перебора паролей.  

---

# Задание 4. Анализ логов  

## Цель  
Изучить, какие подключения выполнялись к серверу, и разделить их на успешные и неуспешные.  

## Просмотр логов  

```bash
sudo less /var/log/auth.log
```

## Результат анализа  

Была получена таблица:  

```
192.168.0.105  0   4
192.168.0.109  0   1
IP             FAILED  OK
```

### Пояснение  
С IP-адреса **192.168.0.105** было выполнено 4 успешных подключения.  
С IP-адреса **192.168.0.109** — одно успешное подключение.  
Ошибок входа (**FAILED**) не зафиксировано.  

---

# Задание 5. Дополнительное  

## Приветственное сообщение (MOTD)  

В файл `/etc/motd` было добавлено сообщение. Теперь при входе на сервер отображается:  

```text
  / _ \| '_| '  \| '_ \ / _` | ' \  / _/ _ \ '  \| '  \ || | ' \| |  _| || |    
 /_/ \_\_| |_|_|_|_.__/_\__,_|_||_|_\__\___/_|_|_|_|_|_\_,_|_||_|_|\__|\_, |    
                                 |___|                                 |__/     
 v25.11 rolling for Orange Pi 3B running Armbian Linux 6.12.45-current-rockchip6
                                                                                
 Packages:     Debian stable (bookworm), possible distro upgrade (trixie)       
 Support:      for advanced users (rolling release)                             
 IPv4:         (LAN) 192.168.0.108 (WAN) 85.143.145.158                          
                                                                                
 Performance:                                                                   
 Load:         10%               Uptime:       29 min                            
 Memory usage: 17% of 7.50G                                                     
 CPU temp:     39°C              Usage of /:   5% of 226G                       
 RX today:     4 GiB                                                             
 Commands:                                                                      
                                                                                
 Configuration : armbian-config                                                 
 Monitoring    : htop                                                           
                                                                                
Привет!                                                                         
Last login: Sat Sep 13 19:12:47 2025 from 192.168.0.109                         
admin@orangepi3b:~$     
```

### Пояснение  
Теперь сервер при входе выдает системную информацию и приветственное сообщение **"Привет!"**.  

---

# Итог работы  

SSH был перенесен на порт **22222**.  
Был создан пользователь **nikitachuev** с правами администратора.  
Root-доступ и вход по паролю отключены, подключение выполняется только по ключам.  
Настроены правила iptables, разрешающие только необходимые соединения.  
Установлен и настроен Fail2ban для защиты от перебора паролей.  
Выполнен анализ логов, подтверждающий успешные подключения.  
Настроено приветственное сообщение при входе в систему.  
